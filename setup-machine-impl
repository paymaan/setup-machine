#!/bin/bash

# Root directory for all git repos
gitReposPath=~/git-repos
if ! [[ -f "$gitReposPath" ]]; then
    mkdir -p $gitReposPath
fi

# apt-get packages and install
sudo apt-get update
sudo apt-get --assume-yes install \
     gcc g++ \
     clang lldb-3.8 libclang-common-3.8-dev libclang-3.8-dev libllvm3.8 llvm-3.8 llvm-3.8-dev llvm-3.8-runtime clang-format-3.8 python-clang-3.8 \
     cmake \
     emacs \
     git \
     ghc \
     silversearcher-ag tmux zlib1g-dev tree htop

# clone repos from github; these are needed by things like
# .emacs etc.
# Not guarding "git clone" commands by:
# if ! [[ -f "$repoPath" ]]; then
#    mkdir -p $repoPath
#    git clone ...
# fi
# because new instances will never have these
# even if they do, error log will catch them
cd $gitReposPath 
    # https://github.com/aspiers/smooth-scrolling
    git clone https://github.com/aspiers/smooth-scrolling
    # https://github.com/emacs-helm/helm
    git clone https://github.com/emacs-helm/helm
    # https://github.com/jwiegley/emacs-async
    git clone https://github.com/jwiegley/emacs-async
    # https://github.com/syohex/emacs-helm-ag
    git clone https://github.com/syohex/emacs-helm-ag
    # https://github.com/Andersbakken/rtags
    git clone --recursive https://github.com/Andersbakken/rtags
    # https://github.com/paymaan/tut-notes
    git clone https://github.com/paymaan/tut-notes.git
cd -

# although initially clones were downloaded using https, set
# up url for ssh so that later git push is seamless with keys
# available
cd $gitReposPath 
    # https://github.com/aspiers/smooth-scrolling
    cd smooth-scrolling
    git remote set-url origin git@github.com:aspiers/smooth-scrolling.git
    cd ..
    # https://github.com/emacs-helm/helm
    cd helm
    git remote set-url origin git@github.com:emacs-helm/helm.git
    cd ..
    # https://github.com/jwiegley/emacs-async
    cd emacs-async
    git remote set-url origin git@github.com:jwiegley/emacs-async.git
    cd ..
    # https://github.com/syohex/emacs-helm-ag
    cd emacs-helm-ag
    git remote set-url origin git@github.com:syohex/emacs-helm-ag.git
    cd ..
    # https://github.com/Andersbakken/rtags
    cd rtags
    git remote set-url origin git@github.com:Andersbakken/rtags.git
    cd ..
    # https://github.com/paymaan/tut-notes
    cd tut-notes
    git remote set-url origin git@github.com:paymaan/tut-notes.git
    cd ..
cd $gitReposPath

# install helm
# https://github.com/emacs-helm/helm
cd ${gitReposPath}/helm
    make
cd -

# install rtags
# https://github.com/Andersbakken/rtags
cd ${gitReposPath}/rtags
    git submodule init
    git submodule update
    mkdir build && cd build
    cmake .. -DCMAKE_EXPORT_COMPILE_COMMANDS=1
    make
    sudo make install # adds rdm, rc, rp to PATH
cd ${gitReposPath}/rtags

# install tmux-mem-cpu-load (tmcl)
# https://github.com/thewtex/tmux-mem-cpu-load
tmclRepoPath=$gitReposPath/tmux-mem-cpu-load
if ! [[ -f "$tmclRepoPath" ]]; then
    mkdir -p $tmclRepoPath
    cd $tmclRepoPath 
        git clone https://github.com/thewtex/tmux-mem-cpu-load.git .
	# setup repo to use ssh for seamless pushing later
	git remote set-url origin git@github.com:thewtex/tmux-mem-cpu-load.git
	cmake . 
	make 
	sudo make install 
    cd -
fi

# download and copy dotfiles to ~/
dotFilesRepoPath=$gitReposPath/dotfiles
if ! [[ -f "$dotFilesRepoPath" ]]; then
    mkdir -p $dotFilesRepoPath
    cd $dotFilesRepoPath 
        git clone https://github.com/paymaan/dotfiles.git .
	# setup repo to use ssh for seamless pushing later
	git remote set-url origin git@github.com:paymaan/dotfiles.git
        # cp and make backup if overwriting
	/bin/cp -fb .* ~/ 
    cd -
fi

exit 0
